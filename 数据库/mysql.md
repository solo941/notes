# 一、数据库索引原理

## B+ Tree

### 1.数据结构

B树即平衡树，是一颗m路查找树，具有的关键性质如下：

1. 每个结点至多m棵子树；
2. 根结点字少有两颗子树，根结点至少有一个关键字；
3. 除根结点外的每个分支结点至少有m/2棵子树；
4. 叶子结点在同一层；
5. 有k颗子树的分支结点存在k-1个关键字；
6. 关键字数量满足┌m/2┐ - 1 <= j <= m - 1。

利用平衡树的优势，查询时间复杂度O(logN),加快了查询的速度。因为数据保存在叶子结点和非叶子结点中，用中序遍历B树的关键字。查找时二分查找。B树结构如图所示：

![pic](https://github.com/solo941/notes/blob/master/数据库/pics/20141027091300383225.png)

B+树基于B树和叶子结点顺序访问指针实现，具有B树的平衡性，又可以通过指针提高查询性能。与B树不同之处在于，结点的关键字不存储数据，只起到索引作用，因此，m个关键字的结点，子节点有m个，关键字数量满足┌m/2┐ - 1 <= j <= m。。B+树的数据存储在叶子结点上，B树的数据存储在每个一结点。因此，B+树搜索过程与高度相同，保证了稳定性，同时横向指针保证可在叶子节点进行区间访问。查找时先在非叶子结点二分查找，再在叶子节点二分查找。插入删除操作会破坏平衡性，需要维护平衡树结构。B+树结构如图所示：

![pic](https://github.com/solo941/notes/blob/master/数据库/pics/20141027091317678858.png)

### 2.与红黑树的比较

题目：为什么数据库系统和文件系统使用B+树作为索引结构，而不是其他平衡树，如红黑树？

- 更少的查找次数：

  平衡树的查找时间复杂度O（h），h为树的高度；红黑树的度为2，树的高度要比B+树大。

- 利用磁盘预读特性：

  每次磁盘I/O操作，会发生预读。预读过程中，磁盘顺序读取，不需要磁盘寻道。数据库利用磁盘预读原理，将一个结点大小设置为一个页大小，每个节点一次I/O可以载入，因此相邻结点能够被预读载入。同时，一个结点的最大度数（m路）取决于节点内key和data的大小，度数越大，深度越小，I/O次数越小。